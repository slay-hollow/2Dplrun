<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¾çµä¼™ä¼´å…»æˆè®° (å›¾ç‰‡ç‰ˆ)</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }
        #game-container {
            width: 400px;
            height: 600px;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        h1 {
            color: #5C6BC0;
            margin-top: 0;
            font-size: 1.8em;
        }

        /* --- ç²¾çµæ˜¾ç¤ºåŒºåŸŸ --- */
        #pet-display {
            width: 100%;
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            background-color: #E8F5E9; /* æµ…ç»¿èƒŒæ™¯ */
            border-radius: 10px;
        }
        #pet-image {
            width: 150px;
            height: 150px;
            /* ç”¨äºæ˜¾ç¤ºå›¾ç‰‡ */
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px; /* å­—ä½“ä½œä¸ºå ä½ç¬¦ */
            transition: transform 0.3s;
        }
        #pet-status-text {
            margin-top: 10px;
            font-weight: bold;
            color: #388E3C;
            text-align: center;
        }

        /* --- å±æ€§æ¡ (HUD) --- */
        #attributes {
            width: 100%;
            margin-bottom: 20px;
        }
        .attribute-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .attr-label {
            width: 80px;
            font-weight: bold;
        }
        .bar-container {
            flex-grow: 1;
            height: 12px;
            background-color: #ddd;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #aaa;
        }
        .bar-fill {
            height: 100%;
            transition: width 0.3s ease-out, background-color 0.3s;
        }

        /* --- äº’åŠ¨æŒ‰é’® --- */
        #actions {
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding-top: 10px;
            border-top: 1px solid #ccc;
        }
        .action-button {
            display: flex;
            flex-direction: row; /* è¡Œæ’åˆ— */
            align-items: center;
            cursor: pointer;
            padding: 10px 15px; 
            border-radius: 8px;
            transition: background-color 0.2s;
            background-color: #5C6BC0;
            color: white;
            border: none;
            font-size: 1em;
            font-weight: bold;
        }
        .action-button:hover {
            background-color: #3F51B5;
        }
        .action-button span {
            margin-left: 5px;
        }

        /* --- é¢å¤–ä¿¡æ¯ --- */
        #debug-info {
            margin-top: 15px;
            font-size: 0.8em;
            color: #999;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>ç²¾çµä¼™ä¼´å…»æˆè®°</h1>

        <div id="pet-display">
            <div id="pet-image">ğŸ¥š</div> <div id="pet-status-text"></div>
        </div>

        <div id="attributes">
            <div class="attribute-bar">
                <span class="attr-label">é¥±é£Ÿåº¦</span>
                <div class="bar-container">
                    <div id="hunger-bar" class="bar-fill" style="width:100%; background-color: #4CAF50;"></div>
                </div>
            </div>
            <div class="attribute-bar">
                <span class="attr-label">å¿ƒæƒ…å€¼</span>
                <div class="bar-container">
                    <div id="happiness-bar" class="bar-fill" style="width:100%; background-color: #FFEB3B;"></div>
                </div>
            </div>
            <div class="attribute-bar">
                <span class="attr-label">æ¸…æ´åº¦</span>
                <div class="bar-container">
                    <div id="cleanliness-bar" class="bar-fill" style="width:100%; background-color: #03A9F4;"></div>
                </div>
            </div>
        </div>

        <div id="actions">
            <button class="action-button" onclick="PetGame.feed()">
                <span>ğŸ” å–‚é£Ÿ</span>
            </button>
            <button class="action-button" onclick="PetGame.play()">
                <span>ğŸ€ ç©è€</span>
            </button>
            <button class="action-button" onclick="PetGame.clean()">
                <span>ğŸ§¼ æ¸…æ´</span>
            </button>
        </div>

        <div id="debug-info">
            é˜¶æ®µ: <span id="stage-display">è›‹</span> | 
            å¹´é¾„: <span id="age-display">0</span> ç§’ | 
            çŠ¶æ€: <span id="health-status">æ­£åœ¨åŠ è½½...</span>
        </div>
    </div>
    
    <p style="margin-top: 20px;"><a href="index.html" style="color: #5C6BC0;">è¿”å›æ¸¸æˆå¤§å…</a></p>

    <script>
        // --- 1. æ ¸å¿ƒé…ç½®ä¸èµ„æºè·¯å¾„ ---
        
        const DECAY_RATE = 1000; // æ¯ 1000ms (1ç§’) æ›´æ–°ä¸€æ¬¡çŠ¶æ€
        
        const STAGES = {
            EGG: 'è›‹',      
            BABY: 'å¹¼å´½',   
            TEEN: 'å°‘å¹´', 
            ADULT: 'æˆç†Ÿ'  
        };
        
        // æ¯ä¸ªé˜¶æ®µéœ€è¦çš„â€œå¹´é¾„â€ï¼ˆæ›´æ–°æ¬¡æ•°ï¼‰
        const EVOLUTION_AGE = {
            BABY: 10,  // 10ç§’åç ´å£³
            TEEN: 30,  // 30ç§’åæˆé•¿
            ADULT: 60   // 60ç§’åæˆç†Ÿ
        };

        // èµ„æºè·¯å¾„ (å·²æ›´æ–°ä»¥åŒ¹é…æ‚¨çš„æ–‡ä»¶åå’Œè·¯å¾„)
        const ASSET_PATHS = {
            'è›‹': 'images/è›‹.png',
            'å¹¼å´½': 'images/å¹¼å´½.png',
            'å°‘å¹´': 'images/å°‘å¹´.png',
            'æˆç†Ÿ': 'images/æˆç†Ÿ.png',
        };

        const assets = {};
        
        // --- 2. æ¸¸æˆçŠ¶æ€å’Œ DOM å…ƒç´  ---
        
        const PetState = {
            hunger: 100,      // 0 = é¥±, 100 = é¥¿
            happiness: 100,   // 0 = æ²®ä¸§, 100 = å¿«ä¹
            cleanliness: 100, // 0 = å¹²å‡€, 100 = è„
            age: 0,           
            currentStage: STAGES.EGG
        };

        const DOM = {
            petImage: document.getElementById('pet-image'),
            statusText: document.getElementById('pet-status-text'),
            hungerBar: document.getElementById('hunger-bar'),
            happinessBar: document.getElementById('happiness-bar'),
            cleanlinessBar: document.getElementById('cleanliness-bar'),
            stageDisplay: document.getElementById('stage-display'),
            ageDisplay: document.getElementById('age-display'),
            healthStatus: document.getElementById('health-status'),
        };

        let gameLoopInterval = null;
        
        // --- 3. æ ¸å¿ƒæ¸¸æˆé€»è¾‘ ---
        
        const PetGame = {
            
            // 3.1. åˆå§‹åŒ–
            init: function() {
                this.loadAssets().then(() => {
                    DOM.healthStatus.textContent = "è‰¯å¥½";
                    this.updateDisplay();
                    this.startGameLoop();
                });
            },

            // 3.2. èµ„æºåŠ è½½
            loadAssets: function() {
                const promises = [];
                for (const key in ASSET_PATHS) {
                    const img = new Image();
                    img.src = ASSET_PATHS[key];
                    promises.push(new Promise((resolve) => {
                        img.onload = () => {
                            assets[key] = ASSET_PATHS[key];
                            resolve();
                        };
                        img.onerror = () => {
                            console.error(`æ— æ³•åŠ è½½ ${ASSET_PATHS[key]}ï¼Œè¯·æ£€æŸ¥è·¯å¾„å’Œæ–‡ä»¶åï¼`);
                            assets[key] = null; // æ ‡è®°ä¸ºå¤±è´¥ï¼Œä½¿ç”¨å ä½ç¬¦
                            resolve(); 
                        };
                    }));
                }
                // åˆå§‹è®¾ç½®ç²¾çµå›¾ç‰‡
                return Promise.all(promises).then(() => {
                    this.setPetVisual(PetState.currentStage);
                });
            },
            
            setPetVisual: function(stage) {
                // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸ
                if (assets[stage]) {
                    DOM.petImage.style.backgroundImage = `url(${assets[stage]})`;
                    DOM.petImage.textContent = ''; // æ¸…é™¤Emojiå ä½ç¬¦
                    DOM.petImage.style.backgroundColor = 'transparent';
                } else {
                    // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ä½¿ç”¨Emojiå ä½ç¬¦
                    DOM.petImage.style.backgroundImage = 'none';
                    DOM.petImage.style.backgroundColor = '#FFCC80';
                    DOM.petImage.textContent = this.getStageEmoji(stage);
                }
                
                // åŠ¨ç”»æ•ˆæœ
                DOM.petImage.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    DOM.petImage.style.transform = 'scale(1)';
                }, 300);
            },

            getStageEmoji: function(stage) {
                switch (stage) {
                    case STAGES.EGG: return 'ğŸ¥š';
                    case STAGES.BABY: return 'ğŸ£';
                    case STAGES.TEEN: return 'ğŸ¦–';
                    case STAGES.ADULT: return 'ğŸ²';
                    default: return 'â“';
                }
            },

            // 3.3. æ¸¸æˆä¸»å¾ªç¯
            startGameLoop: function() {
                if (gameLoopInterval) clearInterval(gameLoopInterval);
                gameLoopInterval = setInterval(this.updateGame.bind(this), DECAY_RATE);
            },

            updateGame: function() {
                PetState.age++; 
                
                this.decayAttributes();
                this.checkEvolution();
                this.updateDisplay();
                this.checkDeathCondition();
            },
            
            decayAttributes: function() {
                PetState.hunger = Math.min(100, PetState.hunger + 3);
                
                let happinessDecay = 2;
                if (PetState.hunger > 70) happinessDecay += 1;
                if (PetState.cleanliness > 70) happinessDecay += 1;
                PetState.happiness = Math.max(0, PetState.happiness - happinessDecay);
                
                PetState.cleanliness = Math.min(100, PetState.cleanliness + 4);
            },
            
            checkEvolution: function() {
                let newStage = PetState.currentStage;

                if (PetState.age >= EVOLUTION_AGE.ADULT && PetState.currentStage !== STAGES.ADULT) {
                    newStage = STAGES.ADULT;
                } else if (PetState.age >= EVOLUTION_AGE.TEEN && PetState.currentStage !== STAGES.TEEN && PetState.currentStage !== STAGES.ADULT) {
                    newStage = STAGES.TEEN;
                } else if (PetState.age >= EVOLUTION_AGE.BABY && PetState.currentStage === STAGES.EGG) {
                    newStage = STAGES.BABY;
                }

                if (newStage !== PetState.currentStage) {
                    PetState.currentStage = newStage;
                    this.setPetVisual(newStage);
                    DOM.statusText.textContent = `ğŸ‰ æ­å–œï¼å·²è¿›åŒ–è‡³ã€${newStage}ã€‘å½¢æ€ï¼`;
                } else {
                    this.updateStatusText();
                }
            },
            
            checkDeathCondition: function() {
                if (PetState.hunger >= 95 && PetState.happiness <= 10) {
                    DOM.healthStatus.textContent = "ğŸ’” æ­»äº¡ï¼ç¼ºä¹ç…§é¡¾ï¼";
                    clearInterval(gameLoopInterval);
                    DOM.statusText.textContent = "ğŸ˜­ æ¸¸æˆç»“æŸï¼æ‚¨çš„ç²¾çµå·²ç»ç¦»æ‚¨è€Œå»ã€‚";
                    document.querySelectorAll('.action-button').forEach(btn => btn.disabled = true);
                } else if (PetState.happiness < 30 || PetState.hunger > 80 || PetState.cleanliness > 80) {
                    DOM.healthStatus.textContent = "ğŸ˜” çŠ¶æ€ä¸ä½³ï¼";
                } else {
                    DOM.healthStatus.textContent = "ğŸ˜Š è‰¯å¥½";
                }
            },

            updateStatusText: function() {
                 let text = '';
                 if (PetState.currentStage === STAGES.EGG) {
                     text = 'è€å¿ƒç­‰å¾…ç ´å£³...';
                 } else if (PetState.hunger > 80) {
                     text = 'æˆ‘é¥¿äº†ï¼Œå¿«å–‚æˆ‘ï¼';
                 } else if (PetState.happiness < 40) {
                     text = 'æˆ‘å¾ˆæ— èŠï¼Œé™ªæˆ‘ç©ï¼';
                 } else if (PetState.cleanliness > 80) {
                     text = 'æˆ‘å¤ªè„äº†ï¼Œéœ€è¦æ´—æ¾¡...';
                 } else {
                     text = 'æ„Ÿè§‰æ£’æäº†ï¼';
                 }
                 DOM.statusText.textContent = text;
            },

            // 3.4. ç•Œé¢æ›´æ–°
            updateDisplay: function() {
                DOM.stageDisplay.textContent = PetState.currentStage;
                DOM.ageDisplay.textContent = PetState.age;

                // é¥±é£Ÿåº¦æ¡
                const hungerPercent = 100 - PetState.hunger;
                DOM.hungerBar.style.width = `${hungerPercent}%`;
                DOM.hungerBar.style.backgroundColor = PetState.hunger > 70 ? '#F44336' : '#4CAF50';
                
                // å¿ƒæƒ…å€¼æ¡
                DOM.happinessBar.style.width = `${PetState.happiness}%`;
                DOM.happinessBar.style.backgroundColor = PetState.happiness < 30 ? '#2196F3' : '#FFEB3B';
                
                // æ¸…æ´åº¦æ¡
                const cleanPercent = 100 - PetState.cleanliness;
                DOM.cleanlinessBar.style.width = `${cleanPercent}%`;
                DOM.cleanlinessBar.style.backgroundColor = PetState.cleanliness > 70 ? '#795548' : '#03A9F4';
            },
            
            // 3.5. äº’åŠ¨è¡Œä¸º
            feed: function() {
                if (PetState.currentStage === STAGES.EGG) {
                    DOM.statusText.textContent = "âŒ è›‹å£³è¿˜æ²¡ç ´ï¼Œä¸èƒ½åƒä¸œè¥¿å“¦ï¼";
                    return;
                }
                PetState.hunger = Math.max(0, PetState.hunger - 30);
                PetState.cleanliness = Math.min(100, PetState.cleanliness + 5);
                this.updateDisplay();
                this.updateStatusText();
            },

            play: function() {
                 if (PetState.currentStage === STAGES.EGG) {
                    DOM.statusText.textContent = "âŒ è›‹å£³è¿˜æ²¡ç ´ï¼Œä¸èƒ½ç©è€å“¦ï¼";
                    return;
                }
                PetState.happiness = Math.min(100, PetState.happiness + 25);
                PetState.hunger = Math.min(100, PetState.hunger + 10);
                PetState.cleanliness = Math.min(100, PetState.cleanliness + 10);
                this.updateDisplay();
                this.updateStatusText();
            },

            clean: function() {
                 if (PetState.currentStage === STAGES.EGG) {
                    DOM.statusText.textContent = "âŒ è›‹å£³æ˜¯å¹²å‡€çš„ï¼";
                    return;
                }
                PetState.cleanliness = Math.max(0, PetState.cleanliness - 40);
                PetState.happiness = Math.min(100, PetState.happiness + 5);
                this.updateDisplay();
                this.updateStatusText();
            }
        };

        // --- 4. å¯åŠ¨æ¸¸æˆ ---
        window.onload = function() {
            PetGame.init();
        };

        // æš´éœ²ç»™ HTML onclick
        window.PetGame = PetGame;
    </script>
</body>
</html>
